<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="zh-TW"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="zh-TW"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="zh-TW"> <![endif]-->
<!--[if gt IE 8]><!-->
<html xmlns="https://www.w3.org/1999/xhtml" dir="ltr" lang="zh-Hant-TW"  prefix="og: http://ogp.me/ns#" class="no-js">
<!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>陳波家族v7.0</title>  
  <link rel="stylesheet" href="https://dabeng.github.io/OrgChart/css/jquery.orgchart.css">
  <link rel="stylesheet" href="https://dabeng.github.io/OrgChart/css/style.css">
  <style type="text/css">
    .orgchart { background: #fff; }
    .orgchart td.left, .orgchart td.right, .orgchart td.top { border-color: #aaa; }
    .orgchart td>.down { background-color: #aaa; }
    .orgchart .middle-level .title { background-color: #006699; }
    .orgchart .middle-level .content { border-color: #006699; }
    .orgchart .product-dept .title { background-color: #009933; }
    .orgchart .product-dept .content { border-color: #009933; }
    .orgchart .rd-dept .title { background-color: #993366; }
    .orgchart .rd-dept .content { border-color: #993366; }
    .orgchart .pipeline1 .title { background-color: #996633; }
    .orgchart .pipeline1 .content { border-color: #996633; }
    .orgchart .frontend1 .title { background-color: #cc0066; }
    .orgchart .frontend1 .content { border-color: #cc0066; }
    #chart-container {height: 620px;}
  </style>
</head>
<body>
<div id="chart-container"></div>

<script type="text/javascript" src="https://dabeng.github.io/OrgChart/js/jquery.min.js"></script>
<script type="text/javascript" src="https://dabeng.github.io/OrgChart/js/jquery.orgchart.js"></script>
<script type="text/javascript">
$(function() {
	let jsonurl = 'https://spreadsheets.google.com/feeds/list/1vMI_OAIRDP-mGqM0GrcCUgea47C-HHm0o2N3QcgMWLg/od6/public/values?alt=json';
	let pdJson, pdSource, pdGrand=[], pdParent=[], pdPeer=[], pdChildren=[];
    $.get(jsonurl, function(data) {
  		pdJson = data.feed.entry;
  		//console.log(pdJson[0]);
  		//pdJson[0].gsx$parent.$t
  		//pdJson[0].gsx$姓名.$t
  		//pdJson[0].gsx$排行.$t
  		
  		$.each(pdJson, function(k4,v4) {
  			//第四代
    		if(v4.gsx$parent.$t == 0){
    			//第五代
  				$.each(pdJson, function(k5,v5) {
  					if(v5.gsx$parent.$t == k4){
  						//第六代
  						$.each(pdJson, function(k6,v6) {
  							if(v6.gsx$parent.$t == k5){
  								//第七代
  								$.each(pdJson, function(k7,v7) {
  									if(v7.gsx$parent.$t == k6){
  										pdChildren.push({'name': v7.gsx$姓名.$t, 'title': '', 'sort':v7.gsx$排行.$t, 'className': 'middle-level', 'children': []});
  									}
  								});
  								//排序ASC
  								pdChildren = pdChildren.sort(function (a, b) { return a.sort > b.sort ? 1 : -1;});
  								//console.log(pdChildren.sort());
  								pdPeer.push({'name': v6.gsx$姓名.$t, 'title': '', 'sort':v6.gsx$排行.$t, 'className': 'middle-level', 'children': pdChildren});
  								//clear
  								pdChildren = [];
  							}
  						});
  						//排序ASC
  						pdPeer = pdPeer.sort(function (a, b) { return a.sort > b.sort ? 1 : -1;});
  						//console.log(pdPeer.sort());
  						pdParent.push({'name': v5.gsx$姓名.$t, 'title': '', 'sort':v5.gsx$排行.$t, 'className': 'middle-level', 'children': pdPeer});
  						//clear
    					pdPeer = [];
	  				}
  				});
  				//排序ASC
  				pdParent = pdParent.sort(function (a, b) { return a.sort > b.sort ? 1 : -1;});
  				//console.log(pdParent.sort());
    			pdGrand.push({'name': v4.gsx$姓名.$t, 'title': '', 'className': 'product-dept', 'children': pdParent});
    		}
    		//clear
    		pdParent = [];
  		});
		pdSource = {
			'name': '陳佛',
      		'title': '',
      		'children':[{ 'name': pdJson[0].gsx$姓名.$t, 'title': '', 'className': 'middle-level', 
      			'children': pdGrand },
      		{ 'name': '陳春耕', 'title': '', 'className': 'middle-level', 'children': [] }]
		};
  		$('#chart-container').orgchart({
      		'data' : pdSource,
      		'nodeContent': 'title'
    	});
	});
	
	
/*
    var datascource = {
      'name': '陳佛',
      'title': '',
      'children': [
        { 'name': 'Bo Miao', 'title': 'department manager', 'className': 'middle-level',
          'children': [
            { 'name': 'Li Jing', 'title': 'senior engineer', 'className': 'product-dept' },
            { 'name': 'Li Xin', 'title': 'senior engineer', 'className': 'product-dept',
              'children': [
                { 'name': 'To To', 'title': 'engineer', 'className': 'pipeline1' },
                { 'name': 'Fei Fei', 'title': 'engineer', 'className': 'pipeline1' },
                { 'name': 'Xuan Xuan', 'title': 'engineer', 'className': 'pipeline1' }
              ]
            }
          ]
        },
        { 'name': 'Su Miao', 'title': 'department manager', 'className': 'middle-level',
          'children': [
            { 'name': 'Pang Pang', 'title': 'senior engineer', 'className': 'rd-dept' },
            { 'name': 'Hei Hei', 'title': 'senior engineer', 'className': 'rd-dept',
              'children': [
                { 'name': 'Xiang Xiang', 'title': 'UE engineer', 'className': 'frontend1' },
                { 'name': 'Dan Dan', 'title': 'engineer', 'className': 'frontend1' },
                { 'name': 'Zai Zai', 'title': 'engineer', 'className': 'frontend1' }
              ]
            }
          ]
        }
      ]
    };
*/
    

  });
</script>
</body>
</html>